{% extends "base.html" %}

{% block content %}
<div class="container-fluid py-4">
  <!-- Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow border-0 rounded-4">
        <div class="card-body p-4">
          <div class="row align-items-center">
            <div class="col-md-6">
              <h2 class="fw-bold mb-0">
                <i class="fas fa-users me-2 text-primary"></i>User Management
              </h2>
              <p class="text-muted mb-0">Manage all registered users</p>
            </div>
            <div class="col-md-6 text-md-end">
              <div class="d-flex gap-2 justify-content-md-end">
                <a href="{{ url_for('database_viewer') }}" class="btn btn-outline-primary rounded-pill">
                  <i class="fas fa-database me-2"></i>Database Viewer
                </a>
                <a href="{{ url_for('admin_home') }}" class="btn btn-outline-secondary rounded-pill">
                  <i class="fas fa-arrow-left me-2"></i>Admin Dashboard
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Users Table -->
  <div class="row">
    <div class="col-12">
      <div class="card shadow border-0 rounded-4">
        <div class="card-header bg-primary text-white rounded-top">
          <div class="row align-items-center">
            <div class="col">
              <h5 class="mb-0">
                <i class="fas fa-users me-2"></i>Registered Users
              </h5>
            </div>
            <div class="col-auto">
              <span class="badge bg-light text-primary">
                {{ users|length }} Total Users
              </span>
            </div>
          </div>
        </div>
        <div class="card-body p-0">
          {% if users %}
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="table-light">
                  <tr>
                    <th>
                      <i class="fas fa-hashtag me-1"></i>ID
                    </th>
                    <th>
                      <i class="fas fa-user me-1"></i>Name
                    </th>
                    <th>
                      <i class="fas fa-envelope me-1"></i>Email
                    </th>
                    <th>
                      <i class="fas fa-phone me-1"></i>Phone
                    </th>
                    <th>
                      <i class="fas fa-calendar me-1"></i>DOB
                    </th>
                    <th>
                      <i class="fas fa-map-marker-alt me-1"></i>Address
                    </th>
                    <th>
                      <i class="fas fa-cogs me-1"></i>Actions
                    </th>
                  </tr>
                </thead>
                <tbody>
                  {% for user in users %}
                  <tr>
                    <td>
                      <span class="badge bg-primary">{{ user.id }}</span>
                    </td>
                    <td>
                      <div class="d-flex align-items-center">
                        <div class="bg-primary bg-gradient rounded-circle p-2 me-2">
                          <i class="fas fa-user text-white"></i>
                        </div>
                        <div>
                          <strong>{{ user.uname }} {{ user.lname }}</strong><br>
                          <small class="text-muted">@{{ user.username }}</small>
                        </div>
                      </div>
                    </td>
                    <td>
                      <a href="mailto:{{ user.email }}" class="text-decoration-none">
                        <i class="fas fa-envelope me-1"></i>{{ user.email }}
                      </a>
                    </td>
                    <td>
                      <a href="tel:{{ user.phone }}" class="text-decoration-none">
                        <i class="fas fa-phone me-1"></i>{{ user.phone }}
                      </a>
                    </td>
                    <td>
                      <span class="badge bg-info">{{ user.date }}</span>
                    </td>
                    <td>
                      <small class="text-muted">{{ user.address[:30] }}{% if user.address|length > 30 %}...{% endif %}</small>
                    </td>
                    <td>
                      <div class="btn-group" role="group">
                        <a href="{{ url_for('edit_user', id=user.id) }}" 
                           class="btn btn-sm btn-warning rounded-pill" 
                           title="Edit User">
                          <i class="fas fa-edit"></i>
                        </a>
                        <form method="post" action="{{ url_for('delete_user', id=user.id) }}" 
                              style="display: inline;" 
                              onsubmit="return confirm('Are you sure you want to delete user {{ user.uname }} {{ user.lname }}?')">
                          <button type="submit" class="btn btn-sm btn-danger rounded-pill" 
                                  title="Delete User">
                            <i class="fas fa-trash"></i>
                          </button>
                        </form>
                      </div>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="text-center py-5">
              <i class="fas fa-users fa-3x text-muted mb-3"></i>
              <h5 class="text-muted">No Users Found</h5>
              <p class="text-muted">There are no registered users in the system yet.</p>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Statistics -->
  <div class="row mt-4">
    <div class="col-md-3">
      <div class="card border-0 shadow-sm rounded-3">
        <div class="card-body text-center">
          <i class="fas fa-users fa-2x text-primary mb-2"></i>
          <h4 class="fw-bold">{{ users|length }}</h4>
          <p class="text-muted mb-0">Total Users</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm rounded-3">
        <div class="card-body text-center">
          <i class="fas fa-user-plus fa-2x text-success mb-2"></i>
          <h4 class="fw-bold">{{ users|length // 10 }}</h4>
          <p class="text-muted mb-0">New This Month</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm rounded-3">
        <div class="card-body text-center">
          <i class="fas fa-user-check fa-2x text-info mb-2"></i>
          <h4 class="fw-bold">{{ (users|length * 0.8)|round|int }}</h4>
          <p class="text-muted mb-0">Active Users</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card border-0 shadow-sm rounded-3">
        <div class="card-body text-center">
          <i class="fas fa-user-shield fa-2x text-warning mb-2"></i>
          <h4 class="fw-bold">7</h4>
          <p class="text-muted mb-0">Admin Users</p>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.table-responsive {
  max-height: 600px;
  overflow-y: auto;
}

.table-hover tbody tr:hover {
  background-color: rgba(0, 123, 255, 0.05);
  cursor: pointer;
}

.card {
  transition: all 0.3s ease;
}

.card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.1);
}

.btn-group .btn {
  margin: 0 2px;
  transition: all 0.3s ease;
}

.btn:hover {
  transform: translateY(-1px);
}

.badge {
  font-size: 0.8em;
}
</style>

<script>
// Add search functionality
document.addEventListener('DOMContentLoaded', function() {
  // Add search input if needed
  const table = document.querySelector('table');
  if (table && table.rows.length > 1) {
    const searchDiv = document.createElement('div');
    searchDiv.className = 'mb-3';
    searchDiv.innerHTML = `
      <div class="input-group">
        <span class="input-group-text bg-primary text-white">
          <i class="fas fa-search"></i>
        </span>
        <input type="text" class="form-control" id="userSearch" placeholder="Search users by name, email, or phone...">
      </div>
    `;
    
    const cardBody = table.closest('.card-body');
    cardBody.insertBefore(searchDiv, table);
    
    // Add search functionality
    document.getElementById('userSearch').addEventListener('keyup', function() {
      const searchTerm = this.value.toLowerCase();
      const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
      
      for (let row of rows) {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(searchTerm) ? '' : 'none';
      }
    });
  }
});
</script>
{% endblock %}
